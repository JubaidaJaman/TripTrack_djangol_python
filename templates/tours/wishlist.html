{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-heart text-danger me-2"></i>My Wishlist</h2>
                <a href="{% url 'tour_list' %}" class="btn btn-primary">Explore More Tours</a>
            </div>

            {% if wishlist_tours %}
            <div class="row">
                {% for tour in wishlist_tours %}
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card tour-card h-100">
                        {% if tour.image %}
                        <img src="{{ tour.image.url }}" class="card-img-top" alt="{{ tour.title }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-university fa-3x text-white"></i>
                        </div>
                        {% endif %}
                        
                        <!-- Remove from wishlist button -->
                        <div class="position-absolute top-0 end-0 m-2">
                            <button class="wishlist-btn active" 
                                    data-tour="{{ tour.id }}" 
                                    onclick="toggleWishlist({{ tour.id }})">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        
                        <div class="card-body">
                            <span class="badge bg-primary mb-2">{{ tour.get_category_display }}</span>
                            <h5 class="card-title">{{ tour.title }}</h5>
                            <p class="card-text">{{ tour.description|truncatewords:15 }}</p>
                            <div class="mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i>By {{ tour.organizer.username }}
                                </small>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="h5 price-taka">
                                    {% if tour.price == 0 %}
                                        FREE
                                    {% else %}
                                        {{ tour.price }} ৳
                                    {% endif %}
                                </span>
                                <a href="{% url 'tour_detail' tour.id %}" class="btn btn-primary btn-sm">Details</a>
                            </div>
                        </div>
                        <div class="card-footer">
                            <small class="text-muted">
                                <i class="far fa-clock me-1"></i>{{ tour.duration_hours }}h • 
                                <i class="far fa-calendar me-1"></i>{{ tour.tour_date|date:"M d" }}
                            </small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-heart fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Your wishlist is empty</h4>
                <p class="text-muted">Start exploring tours and add them to your wishlist!</p>
                <a href="{% url 'tour_list' %}" class="btn btn-primary">Browse Tours</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.wishlist-btn {
    border: none;
    background: rgba(255,255,255,0.9);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.wishlist-btn:hover {
    background: white;
    transform: scale(1.1);
}

.wishlist-btn.active {
    color: #dc3545;
}
</style>

<script>
function toggleWishlist(tourId) {
    fetch(`/tours/wishlist/toggle/${tourId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (!data.added) {
            // Remove from UI
            const tourCard = document.querySelector(`[data-tour="${tourId}"]`).closest('.col-lg-3');
            tourCard.remove();
            
            // Show message if wishlist is empty
            if (document.querySelectorAll('.tour-card').length === 0) {
                location.reload();
            }
        }
    });
}
</script>
{% endblock %}