<!-- tourist_dashboard/templates/tourist_dashboard/dashboard.html -->
{% extends "base.html" %}
{% load static %}
{% block title %}Tourist Dashboard{% endblock %}
{% block content %}
<div class="container" style="max-width:1100px;margin:18px auto;padding:12px;">

  <h1>Welcome, {{ user.get_full_name|default:user.username }}</h1>
  <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap;">
    <div style="flex:1;min-width:200px;padding:12px;border:1px solid #e5e7eb;border-radius:6px;">
      <h3>Profile</h3>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><a href="{% url 'tourist_dashboard:edit_profile' %}">Edit profile</a></p>
    </div>

    <div style="flex:1;min-width:200px;padding:12px;border:1px solid #e5e7eb;border-radius:6px;">
      <h3>Stats</h3>
      <p><strong>Total bookings:</strong> {{ stats.total_bookings|default:0 }}</p>
      <p><strong>Total spent:</strong> ৳{{ stats.total_spent|default:"0.00" }}</p>
    </div>

    <div style="flex:1;min-width:200px;padding:12px;border:1px solid #e5e7eb;border-radius:6px;">
      <h3>Quick Links</h3>
      <p><a href="{% url 'tourist_dashboard:dashboard' %}">Dashboard Home</a></p>
      <p><a href="{% url 'tourist_dashboard:saved_tours' %}">Saved Tours</a></p>
    </div>
  </div>

  <hr style="margin:18px 0;">

  <!-- Upcoming bookings -->
  <section style="margin-top:10px;">
    <h2>Upcoming bookings</h2>
    {% if booking_model_exists %}
      {% if upcoming_bookings %}
        <ul>
          {% for b in upcoming_bookings %}
            <li style="margin-bottom:10px;padding:8px;border:1px solid #f1f5f9;border-radius:6px;">
              <div style="display:flex;justify-content:space-between">
                <div>
                  {% if b.tour %}
                    <strong>{{ b.tour.title }}</strong><br/>
                  {% endif %}
                  <small>Start: {{ b.start_date|default:"-" }}</small>
                </div>
                <div style="text-align:right;">
                  <div>৳{{ b.total_price|default:"-" }}</div>
                  <div><a href="{% url 'tourist_dashboard:booking_detail' b.id %}">View</a></div>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>

        <div>
          {% if upcoming_bookings.has_previous %}
            <a href="?up_page={{ upcoming_bookings.previous_page_number }}">Prev</a>
          {% endif %}
          {% if upcoming_bookings.has_next %}
            <a href="?up_page={{ upcoming_bookings.next_page_number }}">Next</a>
          {% endif %}
        </div>
      {% else %}
        <p>No upcoming bookings found.</p>
      {% endif %}
    {% else %}
      <p><em>Booking model not found in your project. If you have a model that stores bookings, open <code>tourist_dashboard/views.py</code> and update <code>_get_model('tours','Booking')</code> to match its name.</em></p>
    {% endif %}
  </section>

  <!-- Saved tours -->
  <section style="margin-top:20px;">
    <h2>Saved Tours</h2>
    {% if saved_model_exists %}
      {% if saved_tours %}
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
          {% for s in saved_tours %}
            <div style="border:1px solid #e6eef6;padding:10px;border-radius:6px;">
              {% if s.tour.cover_image %}
                <img src="{{ s.tour.cover_image.url }}" alt="" style="width:100%;height:120px;object-fit:cover;border-radius:4px;">
              {% endif %}
              <div style="margin-top:6px;">
                <strong>{{ s.tour.title }}</strong>
                <div>৳{{ s.tour.price|default:"-" }}</div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>You haven't saved any tours yet.</p>
      {% endif %}
    {% else %}
      <p><em>Saved tour model not found. If you track wishlists/saved tours in a different app/model, update the view import.</em></p>
    {% endif %}
  </section>

  <section style="margin-top:24px;">
    <h2>Past bookings</h2>
    {% if booking_model_exists %}
      {% if past_bookings %}
        <ul>
          {% for b in past_bookings %}
            <li style="margin-bottom:8px;">
              {{ b.tour.title|default:"Tour" }} — {{ b.start_date|default:"-" }} — ৳{{ b.total_price|default:"-" }}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No past bookings found.</p>
      {% endif %}
    {% endif %}
  </section>
</div>
{% endblock %}
